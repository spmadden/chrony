#!/usr/bin/make -f

export DEB_BUILD_MAINT_OPTIONS=hardening=+all

BASE=debian/chrony

%:
	dh $@ --parallel

override_dh_auto_configure:
	dh_auto_configure --  --mandir=/usr/share/man \
		--sysconfdir=/etc/chrony \
		--without-readline \
		--with-user=_chrony \
		--enable-scfilter \
		--chronysockdir=/run/chrony

override_dh_auto_build:
	dh_auto_build
	make docs

override_dh_installchangelogs:
	dh_installchangelogs NEWS

override_dh_install:
	dh_install
	install -m 0755 -T debian/apm   $(BASE)/etc/apm/event.d/01chrony
	install -m 0640 -t $(BASE)/etc/chrony/ debian/chrony.keys

override_dh_fixperms:
	dh_fixperms -X etc/chrony/chrony.keys

override_dh_installinit:
	# set boot sequence number for old sysv-rc style
	dh_installinit --update-rcd-params="defaults 83"

override_dh_auto_test:
	# tests disabled

